# æ¨¡çµ„ 13ï¼šå°ˆæ¡ˆå¯¦æˆ°æ¼”ç·´

> æ•´åˆæ‰€æœ‰å­¸éçš„çŸ¥è­˜ï¼šå®Œæ•´é–‹ç™¼æµç¨‹

## ğŸ“Œ å­¸ç¿’ç›®æ¨™
- âœ… æ•´åˆæ‰€æœ‰æ¨¡çµ„çŸ¥è­˜
- âœ… å¾é›¶é–‹å§‹å»ºç½®å°ˆæ¡ˆ
- âœ… å®Œæ•´é™¤éŒ¯æµç¨‹
- âœ… æ•ˆèƒ½åˆ†æèˆ‡æœ€ä½³åŒ–

## 1. å°ˆæ¡ˆç¸½è¦½

```
CMSIS_LM3S å°ˆæ¡ˆæ¶æ§‹
â”œâ”€â”€ CMSIS/              CMSIS æ¨™æº–å‡½å¼åº«
â”‚   â”œâ”€â”€ Include/        æ¨™é ­æª” (arm_math.h, core_cm3.h)
â”‚   â””â”€â”€ DSP_Lib/        271 å€‹ DSP å‡½æ•¸
â”œâ”€â”€ lm3s/               LM3S6965 ç¡¬é«”å®šç¾©
â”œâ”€â”€ examples/           ç¯„ä¾‹ç¨‹å¼
â”‚   â”œâ”€â”€ uart_hello_world/  UART I/O ç¯„ä¾‹
â”‚   â””â”€â”€ arm_fir_example/   FIR æ¿¾æ³¢å™¨ç¯„ä¾‹
â”œâ”€â”€ Dockerfile          QEMU ç’°å¢ƒ
â”œâ”€â”€ Dockerfile.gdb      GDB ç’°å¢ƒ
â””â”€â”€ Makefile            å»ºç½®ç³»çµ±
```

## 2. å®Œæ•´é–‹ç™¼æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 1: éœ€æ±‚åˆ†æ                              â”‚
â”‚   ç¢ºå®šåŠŸèƒ½ã€æ•ˆèƒ½ã€è³‡æºéœ€æ±‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 2: ç³»çµ±è¨­è¨ˆ                              â”‚
â”‚   é¸æ“‡ç¡¬é«”ã€è¨­è¨ˆæ¶æ§‹ã€è¦åŠƒè¨˜æ†¶é«”               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 3: ç·¨å¯«ç¨‹å¼                              â”‚
â”‚   â€¢ æ’°å¯« C ç¨‹å¼ç¢¼                             â”‚
â”‚   â€¢ é…ç½® Makefile                             â”‚
â”‚   â€¢ ç·¨å¯« Linker Script                        â”‚
â”‚   â€¢ å¯¦ä½œ startup code                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 4: ç·¨è­¯å»ºç½®                              â”‚
â”‚   make                                        â”‚
â”‚   æª¢æŸ¥ç·¨è­¯éŒ¯èª¤ã€è­¦å‘Š                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 5: æ¨¡æ“¬æ¸¬è©¦                              â”‚
â”‚   QEMU åŸ·è¡Œç¨‹å¼                               â”‚
â”‚   é©—è­‰åŸºæœ¬åŠŸèƒ½                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 6: é™¤éŒ¯                                  â”‚
â”‚   GDB + QEMU é ç«¯é™¤éŒ¯                        â”‚
â”‚   æ‰¾å‡ºä¸¦ä¿®æ­£ bug                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 7: æ•ˆèƒ½æœ€ä½³åŒ–                            â”‚
â”‚   åˆ†ææ•ˆèƒ½ç“¶é ¸                                â”‚
â”‚   èª¿æ•´æœ€ä½³åŒ–ç­‰ç´š                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 8: éƒ¨ç½²                                  â”‚
â”‚   ç‡’éŒ„åˆ°å¯¦é«”ç¡¬é«” (å¦‚æœ‰)                       â”‚
â”‚   æœ€çµ‚é©—è­‰                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. å¯¦æˆ°ç·´ç¿’ 1: å¾é›¶å»ºç½® UART ç¯„ä¾‹

### æ­¥é©Ÿ 1: æ¸…ç†ç’°å¢ƒ
```bash
cd /home/sbplab/jiawei/qemu/CMSIS_LM3S/examples/uart_hello_world
make clean
ls gcc/  # æ‡‰è©²æ˜¯ç©ºçš„
```

### æ­¥é©Ÿ 2: ç·¨è­¯
```bash
make
# è§€å¯Ÿç·¨è­¯éç¨‹:
# CC uart_hello_world.c
# CC startup_gcc.c
# CC system_lm3s.c
# LD uart_hello_world.axf
# ALL IS GOOD, CHILL OUT
```

### æ­¥é©Ÿ 3: æŸ¥çœ‹ç·¨è­¯ç”¢ç‰©
```bash
ls -lh gcc/
# uart_hello_world.axf  (7.3 KB)
# uart_hello_world.bin  (423 B)
# uart_hello_world.o
# startup_gcc.o
# system_lm3s.o
```

### æ­¥é©Ÿ 4: åˆ†æè¨˜æ†¶é«”ä½¿ç”¨
```bash
arm-none-eabi-size gcc/uart_hello_world.axf
#    text    data     bss     dec     hex
#     512      16      64     592     250
```

### æ­¥é©Ÿ 5: åŸ·è¡Œ
```bash
docker run --rm \
    -v $(pwd)/../..:/work:ro \
    cmsis-lm3s-qemu:latest \
    bash -c "cd /work/examples/uart_hello_world/gcc && \
             timeout 3 qemu-system-arm -M lm3s6965evb -nographic \
                     -kernel uart_hello_world.bin"
# è¼¸å‡º: Hellow World?
```

## 4. å¯¦æˆ°ç·´ç¿’ 2: å®Œæ•´é™¤éŒ¯ FIR ç¯„ä¾‹

### æ­¥é©Ÿ 1: å•Ÿå‹• GDB Server
```bash
docker run --rm -d \
    -v /home/sbplab/jiawei/qemu/CMSIS_LM3S:/work:ro \
    -p 1234:1234 \
    --name qemu_fir \
    cmsis-lm3s-qemu:latest \
    bash -c "cd /work/examples/arm_fir_example/gcc && \
             exec qemu-system-arm -M lm3s6965evb -nographic \
                  -kernel arm_fir_example_f32.bin -s -S"
```

### æ­¥é©Ÿ 2: å•Ÿå‹• GDB
```bash
docker run --rm -it \
    -v /home/sbplab/jiawei/qemu/CMSIS_LM3S:/work:ro \
    --network host \
    cmsis-lm3s-gdb:latest \
    bash -c "cd /work/examples/arm_fir_example/gcc && \
             gdb-multiarch arm_fir_example_f32.axf"
```

### æ­¥é©Ÿ 3: GDB é™¤éŒ¯æœƒè©±
```gdb
(gdb) target remote localhost:1234
(gdb) break main
(gdb) continue
Breakpoint 1, 0x00000130 in main ()

# æŸ¥çœ‹ FIR çµæ§‹
(gdb) print S
$1 = {numTaps = 0, pState = 0x0, pCoeffs = 0x0}
# åˆå§‹åŒ–å‰éƒ½æ˜¯ 0

# å–®æ­¥åŸ·è¡Œåˆå§‹åŒ–
(gdb) next
(gdb) print S
$2 = {numTaps = 29, pState = 0x200014f0, pCoeffs = 0x20000008}

# æŸ¥çœ‹ä¿‚æ•¸
(gdb) x/29f S.pCoeffs
0x20000008: -0.0002  0.0000  0.0008  0.0021 ...

# è¨­å®šä¸­æ–·é»åœ¨ arm_fir_f32
(gdb) break arm_fir_f32
(gdb) continue

# æŸ¥çœ‹è¼¸å…¥è³‡æ–™
(gdb) x/32f pSrc

# å–®æ­¥åŸ·è¡Œæ¿¾æ³¢
(gdb) step
(gdb) finish

# æŸ¥çœ‹è¼¸å‡º
(gdb) x/32f pDst

# ç¹¼çºŒåˆ°è¨ˆç®— SNR
(gdb) continue
(gdb) print snr
```

## 5. æ•…éšœæ’é™¤æ¸…å–®

### ç·¨è­¯éŒ¯èª¤

```
âœ“ æª¢æŸ¥äº‹é …:
  â–¡ arm-none-eabi-gcc æ˜¯å¦å®‰è£ï¼Ÿ
  â–¡ Makefile è·¯å¾‘æ˜¯å¦æ­£ç¢ºï¼Ÿ
  â–¡ CMSIS è·¯å¾‘æ˜¯å¦æ­£ç¢ºï¼Ÿ
  â–¡ æ˜¯å¦å®šç¾© -DPART_LM3S6965ï¼Ÿ
  â–¡ æ˜¯å¦å®šç¾© -D ARM_MATH_CM3ï¼Ÿ
```

### åŸ·è¡ŒéŒ¯èª¤

```
âœ“ æª¢æŸ¥äº‹é …:
  â–¡ QEMU æ˜¯å¦å®‰è£ï¼Ÿ
  â–¡ .bin æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼Ÿ
  â–¡ Docker å®¹å™¨ç‹€æ…‹ï¼Ÿ
  â–¡ è·¯å¾‘æ›è¼‰æ˜¯å¦æ­£ç¢ºï¼Ÿ
```

### é™¤éŒ¯éŒ¯èª¤

```
âœ“ æª¢æŸ¥äº‹é …:
  â–¡ GDB Server æ˜¯å¦å•Ÿå‹•ï¼Ÿ(docker ps)
  â–¡ Port 1234 æ˜¯å¦é–‹æ”¾ï¼Ÿ(netstat -tlnp | grep 1234)
  â–¡ ä½¿ç”¨ .axf è€Œé .binï¼Ÿ
  â–¡ --network host æ˜¯å¦è¨­å®šï¼Ÿ
```

## 6. æ•ˆèƒ½æœ€ä½³åŒ–æŠ€å·§

### 1. èª¿æ•´æœ€ä½³åŒ–ç­‰ç´š
```makefile
# makedefs
CFLAGS = -O0  # ç„¡æœ€ä½³åŒ– (é™¤éŒ¯ç”¨)
CFLAGS = -O2  # æœ€ä½³åŒ– (ç™¼å¸ƒç”¨)
CFLAGS = -Os  # å„ªåŒ–å¤§å°
```

### 2. ä½¿ç”¨ CMSIS-DSP
```c
// æ…¢ - æ‰‹å¯«è¿´åœˆ
for(i=0; i<N; i++) {
    sum += a[i] * b[i];
}

// å¿« - CMSIS-DSP (å·²æœ€ä½³åŒ–)
arm_dot_prod_f32(a, b, N, &sum);
```

### 3. å•Ÿç”¨å…§è¯å‡½æ•¸
```c
static inline float32_t fast_sqrt(float32_t x) {
    return arm_sqrt_f32(x);
}
```

### 4. æ¸›å°‘å‡½æ•¸å‘¼å«é–‹éŠ·
```c
// æ…¢ - å¤šæ¬¡å‘¼å«
for(i=0; i<1000; i++) {
    result[i] = process_sample(input[i]);
}

// å¿« - æ‰¹æ¬¡è™•ç†
process_samples(input, result, 1000);
```

## 7. å®Œæ•´æª¢æŸ¥æ¸…å–®

### å°ˆæ¡ˆå®Œæˆåº¦
```
â–¡ ç¨‹å¼ç¢¼æ’°å¯«å®Œæˆ
â–¡ ç·¨è­¯ç„¡éŒ¯èª¤ç„¡è­¦å‘Š
â–¡ QEMU åŸ·è¡Œæ­£ç¢º
â–¡ GDB é™¤éŒ¯é©—è­‰é‚è¼¯
â–¡ è¨˜æ†¶é«”ä½¿ç”¨åˆç†
â–¡ æ•ˆèƒ½ç¬¦åˆéœ€æ±‚
â–¡ ç¨‹å¼ç¢¼å·²è¨»è§£
â–¡ æ–‡æª”å·²æ›´æ–°
```

## ğŸ“ æœ€çµ‚å°ˆæ¡ˆç·´ç¿’

### æŒ‘æˆ°: å»ºç«‹è‡ªå·±çš„ DSP æ‡‰ç”¨

1. åœ¨ examples/ å»ºç«‹æ–°ç›®éŒ„
2. æ’°å¯«ä½¿ç”¨ CMSIS-DSP çš„ç¨‹å¼
3. é…ç½® Makefile
4. ç·¨è­¯ã€åŸ·è¡Œã€é™¤éŒ¯
5. æœ€ä½³åŒ–æ•ˆèƒ½
6. æ’°å¯«æ–‡æª”

**å»ºè­°é¡Œç›®**:
- ç°¡å–®éŸ³è¨Šç­‰åŒ–å™¨ (å¤šå€‹ Biquad)
- ç§»å‹•å¹³å‡æ¿¾æ³¢å™¨
- è¨Šè™Ÿçµ±è¨ˆåˆ†æå·¥å…·

## ğŸ¯ æœ€çµ‚å­¸ç¿’æª¢æŸ¥é»

å®Œæˆæœ¬èª²ç¨‹å¾Œï¼Œä½ æ‡‰è©²èƒ½å¤ ï¼š
- [ ] è§£é‡‹åµŒå…¥å¼ç³»çµ±çš„å®Œæ•´æ¶æ§‹
- [ ] å¾é›¶é–‹å§‹å»ºç½® ARM å°ˆæ¡ˆ
- [ ] ä½¿ç”¨ Makefile è‡ªå‹•åŒ–ç·¨è­¯
- [ ] ç†è§£è¨˜æ†¶é«”ä½ˆå±€èˆ‡å•Ÿå‹•æµç¨‹
- [ ] æ“ä½œ LM3S6965 ç¡¬é«”
- [ ] å¯¦ä½œ FIR/IIR æ¿¾æ³¢å™¨
- [ ] ä½¿ç”¨ Docker å»ºç«‹é–‹ç™¼ç’°å¢ƒ
- [ ] ä½¿ç”¨ QEMU æ¨¡æ“¬ ARM ç¡¬é«”
- [ ] ä½¿ç”¨ GDB é™¤éŒ¯ ARM ç¨‹å¼
- [ ] é‹ç”¨ CMSIS-DSP å‡½å¼åº«
- [ ] é€²è¡Œæ•ˆèƒ½æœ€ä½³åŒ–

## ğŸ‰ æ­å–œå®Œæˆï¼

ä½ å·²ç¶“å®Œæˆäº†å¾é›¶é–‹å§‹çš„åµŒå…¥å¼ç³»çµ±å­¸ç¿’ä¹‹æ—…ï¼

**ä¸‹ä¸€æ­¥å»ºè­°**:
1. æ·±å…¥ç ”ç©¶æ„Ÿèˆˆè¶£çš„ DSP æ¼”ç®—æ³•
2. å˜—è©¦åœ¨å¯¦é«” ARM é–‹ç™¼æ¿ä¸ŠåŸ·è¡Œ
3. å­¸ç¿’ RTOS (FreeRTOS)
4. æ¢ç´¢æ›´å¤š CMSIS çµ„ä»¶

---
**ç‰ˆæœ¬**: 1.0 | **æ—¥æœŸ**: 2025-11-16
